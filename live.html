<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>HTML 5 Boilerplate</title>

    <style>
        *{
            box-sizing: border-box;
        }

        body{
            background: #31383A;
            color: white;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        a{
            color: currentColor; text-decoration: none;
        }




        .artwork{
            width: 5rem;
            aspect-ratio: 1/1;
            position: relative;
            overflow: hidden;
            border-radius: 50%;	
            box-shadow: 0 .3em .7em rgba(0,0,0,.25);
            background: rgb(28, 29, 37);

            flex-shrink: 0 !important;

            margin-right: 1.25rem;
            
            -webkit-backface-visibility: hidden;
            -moz-backface-visibility: hidden;
            -webkit-transform: translate3d(0, 0, 0);
            -moz-transform: translate3d(0, 0, 0);
            
            &:before{
                content: ''; 
                position: absolute; 
                width: 100%; 
                height: 100%;
                z-index: 2;
                background:conic-gradient(from -135deg at 50% 50%, rgba(255, 255, 255, 0) 15%, rgba(255, 255, 255, 1) 25%, rgba(255, 255, 255, 0) 35%, rgba(255, 255, 255, 0) 65%, rgba(255, 255, 255, 1) 75%, rgba(255, 255, 255, 0) 85%);
                mix-blend-mode:  overlay;
                border-radius: 50%;
            }
            &:after{
                content: '';
                padding: 0.3em;
                background: #31383A;
                z-index: 10;
                position: absolute;
                top: 50%; 
                left: 50%;
                transform: translate(-50%, -50%);
                border-radius: 50%;
                box-shadow: inset 0 .2em .2em rgba(0,0,0,.25);
            }
            img{
                display: block;
                width: 100%; 
                height: 100%;
                object-fit: cover;
                animation: spin 3s infinite linear;
                border-radius: 50%;
            }
        }


        @keyframes spin{
            to{
                transform: rotate(360deg);
            }
        }


        .media-item{
            transition: 0.3s ease all;
            display: flex;
            align-items: center;
            background: rgba(0,0,0,0.2);
            border-radius: 100rem;
            padding: 0.9375rem;
            padding-right: 2.5rem;
            max-width: 100%;
            margin: 20px 10px;

            > div{
                flex-shrink: 1; overflow: hidden;
            }
            & .intro{
                font-size: 12px; opacity: 0.6; margin-bottom: 0.3125rem;
            }
            & .title{
                font-weight: 600; font-size: 20px;
                white-space: nowrap; text-overflow: ellipsis; overflow: hidden;
            }
            & .subtitle{
                font-size: 12px; opacity: 0.6; margin-top: 0.3125rem;
                white-space: nowrap; text-overflow: ellipsis; overflow: hidden;
            }

            &.playing{

            }
            &.stopped{
                /* opacity: 0;
                height: 0; */
            }
        }
    </style>

</head>

<body>
    



    <div class="media stopped">
        <a class="media-item" target="_blank">
            <div class="artwork">
                <img src="{Item 3}"/>
            </div>
            <div class="info">
                <div class="intro"></div>
                <div class="title"></div>
                <div class="subtitle"></div>
            </div>
        </a>
    </div>



    
    
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

    <script>



        
        $(document).ready(function(){

            // Function to fetch and update track data
            function updateMediaData() {

                var traktAPIKey = '0d0477ed0e9cf3fdca652206c98c2adf513ad01199daa9418b2b233a7cb84f15';
                var traktUsername = 'amogl';
                var traktApiUrl = 'https://api.trakt.tv/users/' + traktUsername + '/history?limit=1';

                var mediaIntro = "";
                var mediaArtwork = "";
                var mediaTitle = "";
                var mediaSubtitle = "";
                var mediaLink = "";

                function populateData() {
                    $('.media-item .intro').text(mediaIntro);
                    $('.media-item img').attr('src', mediaArtwork);
                    $('.media-item .title').text(mediaTitle);
                    $('.media-item .subtitle').text(mediaSubtitle);
                    $('.media-item').attr('href', mediaLink);
                }
                function clearData() {
                    $('.media-item .intro').text("");
                    $('.media-item img').attr('src', "");
                    $('.media-item .title').text("");
                    $('.media-item .subtitle').text("");
                    $('.media-item').attr('href', "");
                }

                //--Lastfm
                $.ajax({
                    url: 'https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=amogl&api_key=13b29c7c9664ac4eb57a61b39713ee80&format=json&limit=1',
                    dataType: 'json',
                    success: function(data) {

                        if (data.recenttracks && data.recenttracks.track && data.recenttracks.track.length > 0) {
                            var track = data.recenttracks.track[0];

                            if (track["@attr"] && track["@attr"].nowplaying === "true") {

                                mediaIntro = "I'm currently listening to";
                                mediaArtwork = track.image.find(function(image) {
                                    return image.size === 'large';
                                })['#text'];
                                mediaTitle = track.name;
                                mediaSubtitle = track.artist['#text'];
                                mediaLink = track.url;

                                populateData();

                            } else {

                                setTimeout(function (){
                                    //clearData();
                                }, 2000);

                                console.log("No track is currently playing.");
                            }
                        } else {
                            console.log("No track data found in the response.");
                        }
                    },
                });

                //--Trakt
                $.ajax({
                    url: traktApiUrl,
                    type: 'GET',
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Content-Type', 'application/json');
                        xhr.setRequestHeader('trakt-api-version', '2');
                        xhr.setRequestHeader('trakt-api-key', traktAPIKey);
                    },
                    success: function(data) {
                        if (data.length > 0) {
                            var lastWatchedItem = data[0];
                            var itemType = lastWatchedItem.type;
                            var itemName, itemSubtitle;

                            var itemShowNumbers = "";
                            
                            mediaIntro = "I'm currently watching";

                            if (itemType === 'episode') {

                                itemSubtitle = lastWatchedItem.episode.title;
                                itemSeasonNumber = lastWatchedItem.episode.season;
                                itemEpisodeNumber = lastWatchedItem.episode.number;
                                itemShowNumbers = "S" + itemSeasonNumber + "E" + itemEpisodeNumber + " ";

                                //mediaArtwork = "";
                                mediaTitle = lastWatchedItem.show.title;
                                mediaSubtitle = itemShowNumbers + itemSubtitle;
                                //mediaLink = track.url;

                                populateData();

                            } else if (itemType === 'movie') {
                                
                                //mediaArtwork = "";
                                mediaTitle = lastWatchedItem.movie.title;
                                mediaSubtitle = lastWatchedItem.movie.year;
                                //mediaLink = track.url;
                                
                                populateData();
                            }

                            // $('.media-item-trakt .title').text(itemName);
                            // $('.media-item-trakt .subtitle').text(itemShowNumbers + itemSubtitle);
                        
                        }
                    },
                    error: function(err) {
                        console.log('Error: ' + err);
                    }
                });








                //--Update colour
                // $('.media-item-lastfm').fillColor();



            }


            // Initial call to update track data
            setTimeout(function (){
                updateMediaData();
            }, 0);


            // Set interval to update track data every 30 seconds
            setInterval(updateMediaData, 5000); // 30 seconds
        });



    </script>

</body>

</html>
